<html>
<head>
    <title>Canvas tutorial</title>

    <script src="jquery-1.11.3.js"></script>
    <script type="text/javascript">

        //保存上一个点
        var ppx, ppy;
        //保存当前点
        var cpx, cpy;
        //已绘点集合
        var point_array = [];
        //绘制点集合
        var draw_array = [];
        //连接范围半径
        var radius = 50;
        $(function () {
            var canvas = document.getElementById('tutorial');
            if (canvas.getContext) {
                var ctx = canvas.getContext('2d');
            }
//        //for cursor
            var cursor_canvas = document.getElementById('cursor');
            if (cursor_canvas.getContext) {
                var cursor_ctx = cursor_canvas.getContext('2d');
            }
            $(document).mousemove(function (e) {
                drawCursorCircle(e.pageX, e.pageY);
            });
            $('#tutorial').on("mousedown", function () {
                $('#tutorial').on("mousemove", function (e) {
                    console.log("in tutorail");
                    cpx = e.pageX;
                    cpy = e.pageY;
                    point_array.push([cpx, cpy]);
                    drawline(ppx, ppy, cpx, cpy);
                    ppx = cpx;
                    ppy = cpy;
                });
                $('#tutorial').on("mouseup", function (e) { //bind to document to work with IE
                    $('#tutorial').off("mousemove");
                    ppx = undefined;
                    ppy = undefined;
                });
            });

            //================================
            //function define
            //画点
            var drawpoint = function (x, y) {
                ctx.fillStyle = "rgb(0,0,0)";
                ctx.fillRect(x, y, 1, 1);
            };
            //画线（点是不连续的)
            var drawline = function (x1, y1, x2, y2) {
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                for (i = 0; i < point_array.length; i++) {
                    var x = point_array[i][0];
                    var y = point_array[i][1];
                    if (x < x2 + radius && x > x2 - radius) {
                        if (y < y2 + radius && y > y2 - radius) {
                            if ((x - x2) * (x - x2) + (y - y2) * (y - y2) < radius * radius) {
                                draw_array.push([x, y]);
                            }
                        }
                    }
                }
                draw_array = getRand(draw_array, 8);
                for (i = 0; i < draw_array.length; i++) {
                    var xx = draw_array[i][0];
                    var yy = draw_array[i][1];
                    ctx.moveTo(xx, yy);
                    ctx.lineTo(x2, y2);
                    ctx.lineWidth = 0.03;
                    ctx.stroke();
                }
            };
            //产生随机连接点
            var getRand = function (arr, len) {
                arr.sort(function () {
                    return Math.random() - 0.5;
                });
                return arr.slice(0, len);
            };
            //鼠标跟随的圆
            var drawCursorCircle = function (x, y) {
                cursor_ctx.fillStyle = "rgb(0,0,0)";
                cursor_ctx.clearRect(0, 0, canvas.width, canvas.height);
                //大圆
                cursor_ctx.beginPath();
                cursor_ctx.arc(x, y, radius, 0, 2 * Math.PI);
                cursor_ctx.lineWidth = 0.2;
                cursor_ctx.stroke();
                //中心的圆
                cursor_ctx.moveTo(x,y);
                cursor_ctx.arc(x, y, 3, 0, 2* Math.PI);
                cursor_ctx.stroke();
            };
        });

    </script>
    <style type="text/css">
        #tutorial {
            border: 1px solid black;
        }

        #tutorial:hover {
            cursor: none;
        }

        #cursor {
            position: absolute;
            rgba(255, 255, 255, 0.2);
            z-index: -1;
        }
    </style>
</head>
<body>
<canvas id="cursor" width="640" height="480"></canvas>
<canvas id="tutorial" width="640" height="480"></canvas>
</body>
</html>
